<!-- admin-directors.html -->
<main class="container">
  <div class="page-header">
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞–º–∏</h1>
    <div class="header-actions">
      <a routerLink="/admin/movies" class="btn btn-outline">‚Üê –ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ñ–∏–ª—å–º–∞–º–∏</a>
      <button 
        class="btn btn-primary"
        (click)="toggleCreateDirectorForm()"
        [disabled]="isCreatingDirector || isLoading">
        <span *ngIf="!showCreateForm">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏—Å—Å–µ—Ä–∞</span>
        <span *ngIf="showCreateForm">‚úñ –û—Ç–º–µ–Ω–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</span>
      </button>
    </div>
  </div>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
  <div *ngIf="successMessage" class="alert alert-success">
    <span class="icon">‚úì</span>
    {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    <span class="icon">‚úó</span>
    {{ errorMessage }}
  </div>

  <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ -->
  <div *ngIf="showCreateForm" class="form-container new-director-container">
    <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞</h2>
    
    <div class="new-director-form">
      <div class="form-row">
        <div class="form-group">
          <label for="newDirectorName">–ò–º—è <span class="required">*</span></label>
          <input
            type="text"
            id="newDirectorName"
            [(ngModel)]="newDirectorName"
            name="newDirectorName"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
            [disabled]="isCreatingDirector || isLoading">
        </div>

        <div class="form-group">
          <label for="newDirectorSurname">–§–∞–º–∏–ª–∏—è <span class="required">*</span></label>
          <input
            type="text"
            id="newDirectorSurname"
            [(ngModel)]="newDirectorSurname"
            name="newDirectorSurname"
            placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é"
            [disabled]="isCreatingDirector || isLoading">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="newDirectorBirthDate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
          <input
            type="date"
            id="newDirectorBirthDate"
            [(ngModel)]="newDirectorBirthDate"
            name="newDirectorBirthDate"
            [disabled]="isCreatingDirector || isLoading">
        </div>
      </div>

      <!-- –í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ -->
      <div class="form-section">
        <h4>–°—Ç—Ä–∞–Ω–∞ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ <span class="required">*</span></h4>

        <div class="search-box">
          <input
            type="text"
            [(ngModel)]="directorCountrySearchTerm"
            placeholder="–ü–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω—ã..."
            [disabled]="isCreatingDirector || isLoading"
            name="directorCountrySearch">
          <span class="search-icon">üîç</span>
        </div>

        <div *ngIf="isLoading" class="loading-indicator">
          <span class="spinner-small"></span>
          <span>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω...</span>
        </div>

        <div *ngIf="!isLoading && filteredDirectorCountries.length === 0" class="empty-list">
          <p>–°—Ç—Ä–∞–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
        </div>

        <div class="country-list" *ngIf="!isLoading && filteredDirectorCountries.length > 0">
          <div
            *ngFor="let country of filteredDirectorCountries"
            class="country-item"
            [class.selected]="selectedDirectorCountry?.countryId === country.countryId"
            (click)="!isCreatingDirector && selectDirectorCountry(country)"
            [class.disabled]="isCreatingDirector">
            <div class="country-info">
              <span class="country-name">{{ country.countryName }}</span>
              <span class="country-details">
                {{ country.directorList?.length || 0 }} —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–≤
              </span>
            </div>
            <div class="country-id">ID: {{ country.countryId }}</div>
          </div>
        </div>

        <div *ngIf="selectedDirectorCountry" class="selected-info">
          <span>–í—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∞: <strong>{{ selectedDirectorCountry.countryName }}</strong></span>
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ -->
      <div class="form-actions director-actions">
        <button
          type="button"
          class="btn btn-primary"
          (click)="createNewDirector()"
          [disabled]="isCreatingDirector || !newDirectorName.trim() || !newDirectorSurname.trim() || !selectedDirectorCountry">
          <span *ngIf="!isCreatingDirector">–°–æ–∑–¥–∞—Ç—å —Ä–µ–∂–∏—Å—Å–µ—Ä–∞</span>
          <span *ngIf="isCreatingDirector" class="loading-text">
            <span class="spinner-small"></span> –°–æ–∑–¥–∞–Ω–∏–µ...
          </span>
        </button>

        <button
          type="button"
          class="btn btn-outline"
          (click)="resetNewDirectorForm()"
          [disabled]="isCreatingDirector">
          –û—á–∏—Å—Ç–∏—Ç—å
        </button>
      </div>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–≤ -->
  <div class="form-container">
    <div class="list-header">
      <h2>–°–ø–∏—Å–æ–∫ —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–≤</h2>
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="directorSearchTerm"
          placeholder="–ü–æ–∏—Å–∫ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞..."
          [disabled]="isLoading"
          (input)="onSearchChange()">
        <span class="search-icon">üîç</span>
      </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div *ngIf="isLoading" class="loading-indicator">
      <span class="spinner-small"></span>
      <span>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–≤...</span>
    </div>

    <!-- –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ -->
    <div *ngIf="!isLoading && directors.length === 0" class="empty-list">
      <p>–†–µ–∂–∏—Å—Å–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
      <p class="hint">–ù–∞—á–Ω–∏—Ç–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞</p>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–≤ -->
    <div *ngIf="!isLoading && directors.length > 0" class="directors-list">
      <div class="list-stats">
        <span>–í—Å–µ–≥–æ —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–≤: {{ directors.length }}</span>
        <span *ngIf="directorSearchTerm.trim()">–ù–∞–π–¥–µ–Ω–æ: {{ filteredDirectors.length }}</span>
      </div>

      <div class="director-list">
        <div
          *ngFor="let director of filteredDirectors"
          class="director-item"
          [class.selected]="selectedDirectorId === director.directorId"
          (click)="selectDirector(director)">
          <div class="director-info">
            <span class="director-name">{{ director.directorNameAndSurname }}</span>
            <div class="director-details">
              <span class="detail-item">
                <strong>ID:</strong> {{ director.directorId }}
              </span>
              <span *ngIf="director.birthDate" class="detail-item">
                <strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ formatDate(director.birthDate) }}
              </span>
              <span class="detail-item">
                <strong>–°—Ç—Ä–∞–Ω–∞:</strong> {{ getCountryName(director.countryId) }}
              </span>
              <span class="detail-item">
                <strong>–§–∏–ª—å–º–æ–≤:</strong> {{ director.filmList?.length || 0 }}
              </span>
            </div>
          </div>
          <div class="director-actions">
            <button
              class="btn btn-outline btn-small"
              (click)="editDirector(director); $event.stopPropagation()">
              ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
              <button
                class="btn btn-secondary btn-small"
                (click)="deleteDirector(director.directorId); $event.stopPropagation()"
                [disabled]="hasFilms(director)">
                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
              </button>
          </div>
        </div>
      </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div *ngIf="!isLoading && directors.length > 0" class="list-footer">
      <div class="stats">
        <div class="stat-item">
          <span class="stat-label">–í—Å–µ–≥–æ —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–≤:</span>
          <span class="stat-value">{{ directors.length }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">–° —Ñ–∏–ª—å–º–∞–º–∏:</span>
          <span class="stat-value">{{ directorsWithMoviesCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">–ë–µ–∑ —Ñ–∏–ª—å–º–æ–≤:</span>
          <span class="stat-value">{{ directorsWithoutMoviesCount }}</span>
        </div>
      </div>
    </div>
  </div>
</main>