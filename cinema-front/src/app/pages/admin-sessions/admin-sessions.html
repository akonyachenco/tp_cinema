<!-- admin-sessions.html -->
<main class="container admin-sessions">
  <header class="page-header">
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∞–Ω—Å–∞–º–∏</h1>
    <div class="header-actions">
      <button class="btn btn-icon" (click)="refreshSessions()" title="–û–±–Ω–æ–≤–∏—Ç—å">
        <span class="icon">‚Üª</span>
      </button>
    </div>
  </header>

  <div class="admin-actions">
    <a
      [routerLink]="filmId() ? ['/admin/sessions/add', filmId()] : '/admin/sessions/add'"
      class="btn btn-primary"
    >
      <span class="icon">+</span> –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∞–Ω—Å
    </a>

    <div class="filters">
      <!-- –ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
      <div class="filter-group">
        <label>–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:</label>
        <div class="filter-buttons">
          <button
            class="filter-btn"
            [class.active]="filterMode() === 'today' && !dateFilter()"
            (click)="setFilter('today')"
            [disabled]="!!dateFilter()"
          >
            –°–µ–≥–æ–¥–Ω—è
          </button>
          <button
            class="filter-btn"
            [class.active]="filterMode() === 'week' && !dateFilter()"
            (click)="setFilter('week')"
            [disabled]="!!dateFilter()"
          >
            –ù–∞ –Ω–µ–¥–µ–ª—é
          </button>
          <button
            class="filter-btn"
            [class.active]="filterMode() === 'all' || !!dateFilter()"
            (click)="setFilter('all')"
          >
            –í—Å–µ
          </button>
        </div>
        <small class="filter-hint" *ngIf="dateFilter()">
          –ü—Ä–∏ —Ä—É—á–Ω–æ–º –≤—ã–±–æ—Ä–µ –¥–∞—Ç—ã –∞–∫—Ç–∏–≤–µ–Ω —Ñ–∏–ª—å—Ç—Ä "–í—Å–µ"
        </small>
      </div>

      <!-- –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∏–ª—å–º–∞ -->
      <div class="filter-group">
        <label>–§–∏–ª—å–º:</label>
        <input
          type="text"
          class="form-input"
          [value]="filmNameFilter()"
          (input)="updateFilmNameFilter($any($event.target).value)"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞..."
        />
      </div>

      <!-- –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∑–∞–ª–∞ -->
      <div class="filter-group">
        <label>–ó–∞–ª:</label>
        <input
          type="text"
          class="form-input"
          [value]="hallNameFilter()"
          (input)="updateHallNameFilter($any($event.target).value)"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–ª–∞..."
        />
      </div>

      <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É -->
      <div class="filter-group">
        <label>–°—Ç–∞—Ç—É—Å:</label>
        <select
          class="form-select"
          [value]="statusFilter()"
          (change)="updateStatusFilter($any($event.target).value)"
        >
          <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
          <option value="–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</option>
          <option value="–ê–∫—Ç–∏–≤–µ–Ω">–ê–∫—Ç–∏–≤–µ–Ω</option>
          <option value="–ó–∞–≤–µ—Ä—à–µ–Ω">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
          <option value="–û—Ç–º–µ–Ω–µ–Ω">–û—Ç–º–µ–Ω–µ–Ω</option>
        </select>
      </div>

      <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ -->
      <div class="filter-group">
        <label>–î–∞—Ç–∞:</label>
        <input
          type="date"
          class="form-input"
          [value]="dateFilter()"
          (change)="updateDateFilter($any($event.target).value)"
        />
      </div>

      <!-- –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
      <button class="btn btn-outline" (click)="clearFilters()">
        –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
      </button>
    </div>
  </div>

  <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∞–Ω—Å–æ–≤...</p>
    </div>
  }

  <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
  @if (errorMessage() && !isLoading()) {
    <div class="error-state">
      <p class="error-message">{{ errorMessage() }}</p>
      <button class="btn btn-outline" (click)="loadSessions()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É</button>
    </div>
  }


  <!-- –°–ø–∏—Å–æ–∫ —Å–µ–∞–Ω—Å–æ–≤ -->
  @if (!isLoading() && !errorMessage()) {
    <section class="sessions-list">
      @if (filteredSessions().length === 0) {
        <div class="empty-state">
          <p class="empty-text">–°–µ–∞–Ω—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>

          @if (filmNameFilter() || hallNameFilter() || dateFilter() || statusFilter() || filterMode() !== 'all') {
            <div class="empty-suggestions">
              <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
              <ul>
                @if (filmNameFilter()) {
                  <li>–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ñ–∏–ª—å–º–∞</li>
                }
                @if (hallNameFilter()) {
                  <li>–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –∑–∞–ª–∞</li>
                }
                @if (dateFilter()) {
                  <li>–ò–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ</li>
                }
                <li>–ò–∑–º–µ–Ω–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã</li>
                <li><button class="btn-link" (click)="clearFilters()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã</button></li>
              </ul>
            </div>
          }

          @if (filmId() && !filmNameFilter()) {
            <p class="empty-subtext">
              –£ —ç—Ç–æ–≥–æ —Ñ–∏–ª—å–º–∞ –ø–æ–∫–∞ –Ω–µ—Ç —Å–µ–∞–Ω—Å–æ–≤.
              <a [routerLink]="['/admin/sessions/add', filmId()]">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Å–µ–∞–Ω—Å</a>
            </p>
          }
        </div>
      }

      @for (session of filteredSessions(); track session.sessionId) {
        <div class="session-card">
          <div class="session-header">
            <div class="session-id">–°–µ–∞–Ω—Å #{{ session.sessionId }}</div>
            <div class="session-status" [class]="getStatusClass(session.status)">
              {{ getStatusText(session.status) }}
            </div>
          </div>

          <div class="session-body">
            <div class="session-info">
              <div class="info-item">
                <span class="info-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</span>
                <span class="info-value">
                  {{ formatDateTime(session.dateTime) }}
                </span>
              </div>
              <div class="info-item">
                <span class="info-label">–§–∏–ª—å–º:</span>
                <span class="info-value">{{ session.filmTitle }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">–ó–∞–ª:</span>
                <span class="info-value">{{ session.hallName }}</span>
              </div>
              @if (session.filmData?.duration) {
                <div class="info-item">
                  <span class="info-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                  <span class="info-value">{{ session.filmData.duration }} –º–∏–Ω.</span>
                </div>
              }
              @if (session.hallData?.hallType) {
                <div class="info-item">
                  <span class="info-label">–¢–∏–ø –∑–∞–ª–∞:</span>
                  <span class="info-value">{{ session.hallData.hallType }}</span>
                </div>
              }
            </div>
          </div>

          <div class="session-actions">
            <button
              class="btn btn-primary"
              (click)="editSession(session.sessionId)"
              [disabled]="!session.canEdit"
              [title]="session.editTooltip"
              [class.disabled]="!session.canEdit"
            >
              <span class="icon">‚úèÔ∏è</span> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button
              class="btn btn-danger"
              (click)="deleteSession(session.sessionId)"
              [disabled]="!session.canDelete"
              [title]="session.deleteTooltip"
              [class.disabled]="!session.canDelete"
            >
              <span class="icon">üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å
            </button>
          </div>
        </div>
      }
    </section>
  }
</main>
