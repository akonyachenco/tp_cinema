<div class="account-page">
  <div class="container">
    <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>

    @if (!user) {
      <div class="not-authorized">
        <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.</p>
        <a class="btn" routerLink="/login">–í–æ–π—Ç–∏</a>
      </div>
    } @else {
      <div class="account-layout">
        <aside class="sidebar">
          <div class="user-info">
            <div class="avatar">{{ user.name?.charAt(0) }}{{ user.surname?.charAt(0) }}</div>
            <h3>{{ user.name }} {{ user.surname }}</h3>
            <p class="user-email">{{ user.email }}</p>
            <p class="user-meta">
              –í–æ–∑—Ä–∞—Å—Ç: {{ getUserAge(user.birthDate) }} –ª–µ—Ç<br>
              –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å {{ user.registrationDate | date:'dd.MM.yyyy' }}
            </p>
          </div>

          <nav class="sidebar-nav">
            <button
              class="nav-btn"
              [class.active]="activeTab === 'bookings'"
              (click)="setActiveTab('bookings')">
              üìÖ –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            </button>
            <button
              class="nav-btn"
              [class.active]="activeTab === 'profile'"
              (click)="setActiveTab('profile')">
              üë§ –ü—Ä–æ—Ñ–∏–ª—å
            </button>
          </nav>
        </aside>

        <main class="content">
          @if (activeTab === 'bookings') {
            <section class="bookings-section">
              <div class="bookings-header">
                <h2>–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>

                @if (bookings.length > 0) {
                  <div class="status-filters">
                    <button
                      class="filter-btn"
                      [class.active]="isFilterActive('all')"
                      (click)="applyStatusFilter('all')">
                      {{ getFilterText('all') }}
                    </button>
                    <button
                      class="filter-btn"
                      [class.active]="isFilterActive('active')"
                      (click)="applyStatusFilter('active')">
                      {{ getFilterText('active') }}
                    </button>
                    <button
                      class="filter-btn"
                      [class.active]="isFilterActive('completed')"
                      (click)="applyStatusFilter('completed')">
                      {{ getFilterText('completed') }}
                    </button>
                    <button
                      class="filter-btn"
                      [class.active]="isFilterActive('cancelled')"
                      (click)="applyStatusFilter('cancelled')">
                      {{ getFilterText('cancelled') }}
                    </button>
                    <button
                      class="filter-btn"
                      [class.active]="isFilterActive('inactive')"
                      (click)="applyStatusFilter('inactive')">
                      {{ getFilterText('inactive') }}
                    </button>
                  </div>
                }
              </div>

              @if (isLoading) {
                <div class="loading">
                  <div class="spinner"></div>
                  <p>–ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π...</p>
                </div>
              } @else if (bookings.length === 0) {
                <div class="empty-state">
                  <h3>üé≠ –£ –≤–∞—Å –µ—â—ë –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
                  <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –º–µ—Å—Ç–∞, —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–¥–µ—Å—å</p>
                  <a class="btn" routerLink="/">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞—Ñ–∏—à—É</a>
                </div>
              } @else if (filteredBookings.length === 0) {
                <div class="empty-state">
                  <h3>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                  <p>–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º</p>
                  <button class="btn" (click)="applyStatusFilter('all')">
                    –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                  </button>
                </div>
              } @else {
                <div class="bookings-list">
                  @if (activeStatusFilter === 'all') {
                    @if (activeBookings.length > 0) {
                      <div class="bookings-group">
                        <h3 class="group-title">üìå –ê–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                        @for (booking of activeBookings; track booking.bookingId) {
                          <div class="booking-card" [class]="getBookingStatusClass(booking.status)">
                            <div class="booking-header">

                              <span class="booking-status" [class]="getBookingStatusClass(booking.status)">
                                {{ getBookingStatusText(booking.status) }}
                              </span>
                            </div>

                            <div class="booking-info">
                              <p class="booking-time">
                                <strong>–î–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</strong>
                                {{ formatDate(booking.bookingTime) }}
                              </p>

                              @if (booking.filmTitle) {
                                <p class="session-info">
                                  <strong>–§–∏–ª—å–º:</strong> {{ booking.filmTitle }}
                                  @if (booking.sessionTime) {
                                    <br><small>–ù–∞—á–∞–ª–æ —Å–µ–∞–Ω—Å–∞: {{ formatSessionTime(booking.sessionTime) }}</small>
                                  }
                                </p>
                              }

                              <p class="booking-cost">
                                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ booking.totalCost }} ‚ÇΩ
                              </p>
                              <p class="booking-seats">
                                <strong>–ú–µ—Å—Ç–∞:</strong> {{ getSeatNumbers(booking.ticketList || []) }}
                              </p>

                              @if (booking.ticketList && booking.ticketList.length > 0) {
                                <div class="tickets-list">
                                  <strong>–ë–∏–ª–µ—Ç—ã:</strong>
                                  @for (ticket of booking.ticketList; track ticket.ticketId) {
                                    <div class="ticket-item">
                                      –ë–∏–ª–µ—Ç {{ ticket.ticketCode }} - {{ ticket.price }} ‚ÇΩ
                                    </div>
                                  }
                                </div>
                              }
                            </div>

                            <div class="booking-actions">
                              <a class="btn btn-sm" [routerLink]="['/booking', booking.bookingId, 'ticket']">
                                –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∏–ª–µ—Ç
                              </a>
                              @if (booking.canCancel) {
                                <button
                                  class="btn btn-sm btn-outline"
                                  (click)="cancelBooking(booking.bookingId)">
                                  –û—Ç–º–µ–Ω–∏—Ç—å
                                </button>
                              } @else {
                                <span class="cancel-disabled">
                                  –û—Ç–º–µ–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                                </span>
                              }
                            </div>
                          </div>
                        }
                      </div>
                    }

                    @if (completedBookings.length > 0) {
                      <div class="bookings-group">
                        <h3 class="group-title">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                        @for (booking of completedBookings; track booking.bookingId) {
                          <div class="booking-card" [class]="getBookingStatusClass(booking.status)">
                            <div class="booking-header">

                              <span class="booking-status" [class]="getBookingStatusClass(booking.status)">
                                {{ getBookingStatusText(booking.status) }}
                              </span>
                            </div>

                            <div class="booking-info">
                              <p class="booking-time">
                                <strong>–î–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</strong>
                                {{ formatDate(booking.bookingTime) }}
                              </p>

                              @if (booking.filmTitle) {
                                <p class="session-info">
                                  <strong>–§–∏–ª—å–º:</strong> {{ booking.filmTitle }}
                                  @if (booking.sessionTime) {
                                    <br><small>–ù–∞—á–∞–ª–æ —Å–µ–∞–Ω—Å–∞: {{ formatSessionTime(booking.sessionTime) }}</small>
                                  }
                                </p>
                              }

                              <p class="booking-cost">
                                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ booking.totalCost }} ‚ÇΩ
                              </p>
                              <p class="booking-seats">
                                <strong>–ú–µ—Å—Ç–∞:</strong> {{ getSeatNumbers(booking.ticketList || []) }}
                              </p>

                              @if (booking.ticketList && booking.ticketList.length > 0) {
                                <div class="tickets-list">
                                  <strong>–ë–∏–ª–µ—Ç—ã:</strong>
                                  @for (ticket of booking.ticketList; track ticket.ticketId) {
                                    <div class="ticket-item">
                                      –ë–∏–ª–µ—Ç {{ ticket.ticketCode }} - {{ ticket.price }} ‚ÇΩ
                                    </div>
                                  }
                                </div>
                              }
                            </div>
                          </div>
                        }
                      </div>
                    }

                    @if (inactiveBookings.length > 0) {
                      <div class="bookings-group">
                        <h3 class="group-title">‚ö´ –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                        @for (booking of inactiveBookings; track booking.bookingId) {
                          <div class="booking-card" [class]="getBookingStatusClass(booking.status)">
                            <div class="booking-header">

                              <span class="booking-status" [class]="getBookingStatusClass(booking.status)">
                                {{ getBookingStatusText(booking.status) }}
                              </span>
                            </div>

                            <div class="booking-info">
                              <p class="booking-time">
                                <strong>–î–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</strong>
                                {{ formatDate(booking.bookingTime) }}
                              </p>

                              @if (booking.filmTitle) {
                                <p class="session-info">
                                  <strong>–§–∏–ª—å–º:</strong> {{ booking.filmTitle }}
                                  @if (booking.sessionTime) {
                                    <br><small>–ù–∞—á–∞–ª–æ —Å–µ–∞–Ω—Å–∞: {{ formatSessionTime(booking.sessionTime) }}</small>
                                  }
                                </p>
                              }

                              <p class="booking-cost">
                                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ booking.totalCost }} ‚ÇΩ
                              </p>
                              <p class="booking-seats">
                                <strong>–ú–µ—Å—Ç–∞:</strong> {{ getSeatNumbers(booking.ticketList || []) }}
                              </p>

                              @if (booking.ticketList && booking.ticketList.length > 0) {
                                <div class="tickets-list">
                                  <strong>–ë–∏–ª–µ—Ç—ã:</strong>
                                  @for (ticket of booking.ticketList; track ticket.ticketId) {
                                    <div class="ticket-item">
                                      –ë–∏–ª–µ—Ç {{ ticket.ticketCode }} - {{ ticket.price }} ‚ÇΩ
                                    </div>
                                  }
                                </div>
                              }
                            </div>
                          </div>
                        }
                      </div>
                    }

                    @if (cancelledBookings.length > 0) {
                      <div class="bookings-group">
                        <h3 class="group-title">‚ùå –û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                        @for (booking of cancelledBookings; track booking.bookingId) {
                          <div class="booking-card" [class]="getBookingStatusClass(booking.status)">
                            <div class="booking-header">

                              <span class="booking-status" [class]="getBookingStatusClass(booking.status)">
                                {{ getBookingStatusText(booking.status) }}
                              </span>
                            </div>

                            <div class="booking-info">
                              <p class="booking-time">
                                <strong>–î–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</strong>
                                {{ formatDate(booking.bookingTime) }}
                              </p>

                              @if (booking.filmTitle) {
                                <p class="session-info">
                                  <strong>–§–∏–ª—å–º:</strong> {{ booking.filmTitle }}
                                  @if (booking.sessionTime) {
                                    <br><small>–ù–∞—á–∞–ª–æ —Å–µ–∞–Ω—Å–∞: {{ formatSessionTime(booking.sessionTime) }}</small>
                                  }
                                </p>
                              }

                              <p class="booking-cost">
                                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ booking.totalCost }} ‚ÇΩ
                              </p>
                              <p class="booking-seats">
                                <strong>–ú–µ—Å—Ç–∞:</strong> {{ getSeatNumbers(booking.ticketList || []) }}
                              </p>

                              @if (booking.ticketList && booking.ticketList.length > 0) {
                                <div class="tickets-list">
                                  <strong>–ë–∏–ª–µ—Ç—ã:</strong>
                                  @for (ticket of booking.ticketList; track ticket.ticketId) {
                                    <div class="ticket-item">
                                      –ë–∏–ª–µ—Ç {{ ticket.ticketCode }} - {{ ticket.price }} ‚ÇΩ
                                    </div>
                                  }
                                </div>
                              }
                            </div>
                          </div>
                        }
                      </div>
                    }
                  } @else {
                    @for (booking of filteredBookings; track booking.bookingId) {
                      <div class="booking-card" [class]="getBookingStatusClass(booking.status)">
                        <div class="booking-header">

                          <span class="booking-status" [class]="getBookingStatusClass(booking.status)">
                            {{ getBookingStatusText(booking.status) }}
                          </span>
                        </div>

                        <div class="booking-info">
                          <p class="booking-time">
                            <strong>–î–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</strong>
                            {{ formatDate(booking.bookingTime) }}
                          </p>

                          @if (booking.filmTitle) {
                            <p class="session-info">
                              <strong>–§–∏–ª—å–º:</strong> {{ booking.filmTitle }}
                              @if (booking.sessionTime) {
                                <br><small>–ù–∞—á–∞–ª–æ —Å–µ–∞–Ω—Å–∞: {{ formatSessionTime(booking.sessionTime) }}</small>
                              }
                            </p>
                          }

                          <p class="booking-cost">
                            <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ booking.totalCost }} ‚ÇΩ
                          </p>
                          <p class="booking-seats">
                            <strong>–ú–µ—Å—Ç–∞:</strong> {{ getSeatNumbers(booking.ticketList || []) }}
                          </p>

                          @if (booking.ticketList && booking.ticketList.length > 0) {
                            <div class="tickets-list">
                              <strong>–ë–∏–ª–µ—Ç—ã:</strong>
                              @for (ticket of booking.ticketList; track ticket.ticketId) {
                                <div class="ticket-item">
                                  –ë–∏–ª–µ—Ç {{ ticket.ticketCode }} - {{ ticket.price }} ‚ÇΩ
                                </div>
                              }
                            </div>
                          }
                        </div>

                        <div class="booking-actions">
                          @if (booking.status === 'active' || booking.status === '–ê–∫—Ç–∏–≤–Ω–æ') {
                            <a class="btn btn-sm" [routerLink]="['/booking', booking.bookingId, 'ticket']">
                              –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∏–ª–µ—Ç
                            </a>
                            @if (booking.canCancel) {
                              <button
                                class="btn btn-sm btn-outline"
                                (click)="cancelBooking(booking.bookingId)">
                                –û—Ç–º–µ–Ω–∏—Ç—å
                              </button>
                            } @else {
                              <span class="cancel-disabled">
                                –û—Ç–º–µ–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                              </span>
                            }
                          }
                        </div>
                      </div>
                    }
                  }
                </div>
              }
            </section>
          }

          @if (activeTab === 'profile') {
            <section class="profile-section">
              <h2>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>

              <div class="profile-info">
                <div class="info-row">
                  <strong>–ò–º—è:</strong> {{ user.name }}
                </div>
                <div class="info-row">
                  <strong>–§–∞–º–∏–ª–∏—è:</strong> {{ user.surname }}
                </div>
                <div class="info-row">
                  <strong>Email:</strong> {{ user.email }}
                </div>
                <div class="info-row">
                  <strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ user.birthDate | date:'dd.MM.yyyy' }}
                </div>
                <div class="info-row">
                  <strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> {{ getUserAge(user.birthDate) }} –ª–µ—Ç
                </div>
                <div class="info-row">
                  <strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> {{ user.registrationDate | date:'dd.MM.yyyy' }}
                </div>
                <div class="info-row">
                  <strong>–°—Ç–∞—Ç—É—Å:</strong>
                  <span class="user-role">{{ user.role === 'ADMIN' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' }}</span>
                </div>
              </div>
            </section>
          }

        </main>
      </div>
    }
  </div>
</div>
